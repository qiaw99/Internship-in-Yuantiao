
<!DOCTYPE html>
<html>
<head>
    <title>示例 05.09 - PolyhedronGeometry</title>
	<script src="../build/three.js"></script>
	<script src="./js/libs/stats.min.js"></script>
	<script src="./js/utils/SceneUtils.js"></script>
    <style>
        body {
            /* 设置 margin 为 0，并且 overflow 为 hidden，来完成页面样式 */
            margin: 0;
            overflow: hidden;
        }
		/* 统计对象的样式 */
		#Stats-output {
			position: absolute;
			left: 0px;
			top: 0px;
		}
    </style>
</head>
<body>
 
 
<!-- 运行 Three.js 示例的 Javascript 代码 -->
<script type="module">
	import { OrbitControls } from './jsm/controls/OrbitControls.js';
	import { GUI } from './jsm/libs/dat.gui.module.js';
	var scene;
	var camera;
	var render;
	var webglRender;
	//var canvasRender;
	var controls;
	var stats;
	var guiParams;
	
	var ground;
	//var box;
	//var sphere;
	//var cylinder;
	//var plane;
	//var torus;
	//var torusKnot;
	var polyhedron;
	
	var meshMaterial;
	
	var ambientLight;
	var spotLight;
	var axesHelper;
	//var cameraHelper;
 
    
	stats = initStats();
	scene = new THREE.Scene();
	
	webglRender = new THREE.WebGLRenderer( {antialias: true, alpha: true} ); // antialias 抗锯齿
	webglRender.setSize(window.innerWidth, window.innerHeight);
	webglRender.setClearColor(0x000000, 1.0);
	webglRender.shadowMap.enabled = true; // 允许阴影投射
	render = webglRender;
	document.body.appendChild(render.domElement);

	camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.01, 1000); // 2147483647
	camera.position.set(-45.5, 68.2, 90.9);
	
	var target = new THREE.Vector3(10, 0 , 0);
	controls = new OrbitControls(camera, render.domElement);
	controls.target = target;
	camera.lookAt(target);
	
	window.addEventListener('resize', onWindowResize, false);
	
	// 加入一个坐标轴：X（橙色）、Y（绿色）、Z（蓝色）
	axesHelper = new THREE.AxesHelper(60);
	scene.add(axesHelper);
	
	ambientLight = new THREE.AmbientLight(0x0c0c0c);
	scene.add(ambientLight);
	
	spotLight = new THREE.SpotLight(0xffffff);
	spotLight.position.set(0, 60, 30);
	spotLight.shadow.mapSize.width = 5120; // 必须是 2的幂，默认值为 512
	spotLight.shadow.mapSize.height = 5120; // 必须是 2的幂，默认值为 512
	spotLight.castShadow = true;
	scene.add(spotLight);
	//cameraHelper = new THREE.CameraHelper(spotLight.shadow.camera);
	//scene.add(cameraHelper);
	
	// 加入一个地面
	var groundGeometry = new THREE.PlaneGeometry(100, 100, 4, 4);
	var groundMaterial = new THREE.MeshLambertMaterial({color: 0x777777}); // MeshBasicMaterial 材质不能接收阴影
	ground = new THREE.Mesh(groundGeometry, groundMaterial);
	ground.rotation.set(-0.5 * Math.PI, 0, 0); // 沿着 X轴旋转-90°
	ground.receiveShadow = true;
	scene.add(ground);
	
	// 材质
	meshMaterial = [			new THREE.MeshNormalMaterial({side: THREE.DoubleSide}),			new THREE.MeshBasicMaterial({wireframe: true})		];
	
	/** 用来保存那些需要修改的变量 */
	guiParams = new function() {
		this.rotationSpeed = 0.02;
		
		this.radius = 12;
		this.detail = 0;
		this.type = 'Tetrahedron';
	}
	/** 定义 dat.GUI 对象，并绑定 guiParams 的几个属性 */
	var gui = new GUI();
	gui.add(guiParams, 'radius', 1, 30, 1).onChange(function(e){updateMesh()});
	gui.add(guiParams, 'detail', 0, 5, 1).onChange(function(e){updateMesh()});
	gui.add(guiParams, 'type', ['Tetrahedron', 'Octahedron', 'Icosahedron', 'Dodecahedron', 'Polyhedron']).onChange(function(e){updateMesh()});
	
	updateMesh();
	
	renderScene();
   
	
	/** 渲染场景 */
	function renderScene() {
		stats.update();
		//rotateMesh(); // 旋转物体
		
		requestAnimationFrame(renderScene);
		render.render(scene, camera);
	}
	
	/** 初始化 stats 统计对象 */
	function initStats() {
		stats = new Stats();
		stats.setMode(0); // 0 为监测 FPS；1 为监测渲染时间
		return stats;
	}
	
	/** 当浏览器窗口大小变化时触发 */
	function onWindowResize() {
		camera.aspect = window.innerWidth / window.innerHeight;
		camera.updateProjectionMatrix();
		render.setSize(window.innerWidth, window.innerHeight);
	}
	
	/** 旋转物体 */
	var step = 0;
	function rotateMesh() {
		step += guiParams.rotationSpeed;
		scene.traverse(function(mesh) {
			if (mesh instanceof THREE.Mesh && mesh != ground && mesh != axesHelper) {
				//mesh.rotation.x = step;
				mesh.rotation.y = step;
				//mesh.rotation.z = step;
			}
		});
	}
	
	function updateMesh() {
		scene.remove(polyhedron);
		
		// 定义 polyhedron
		var polyhedronGeometry;
		switch(guiParams.type) {
			case 'Tetrahedron': // 四面体
				polyhedronGeometry = new THREE.TetrahedronGeometry(guiParams.radius, guiParams.detail);
				break;
			case 'Octahedron': // 八面体
				polyhedronGeometry = new THREE.OctahedronGeometry(guiParams.radius, guiParams.detail);
				break;
			case 'Dodecahedron': // 十二面体
				polyhedronGeometry = new THREE.DodecahedronGeometry(guiParams.radius, guiParams.detail);
				break;
			case 'Icosahedron': // 二十面体
				polyhedronGeometry = new THREE.IcosahedronGeometry(guiParams.radius, guiParams.detail);
				break;
			case 'Polyhedron': // 自定义多面体
				var verticesOfCube = [
					1, 0, 1,
					1, 0, -1,
					-1, 0, -1,
					-1, 0, 1,
					0, 1, 0
				];
				var indicesOfFaces = [
					0, 1, 2,
					2, 3, 0,
					0, 1, 4,
					1, 2, 4,
					2, 3, 4,
					3, 0, 4
				];
				polyhedronGeometry = new THREE.PolyhedronGeometry(verticesOfCube, indicesOfFaces, guiParams.radius, guiParams.detail);
				break;
		};
		
		polyhedron = new THREE.SceneUtils.createMultiMaterialObject(polyhedronGeometry, meshMaterial);
		//polyhedron.children[1].castShadow = true; // polyhedron.children[0] 的材质是 MeshNormalMaterial，不能投射阴影
		polyhedron.position.set(0, guiParams.radius * 2 + 3, 0);
		scene.add(polyhedron);
	}
 
</script>
</body>
